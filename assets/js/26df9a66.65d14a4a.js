"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[719],{6041:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/plex-smb-diagram-31dd6921631068c9e0a7792633825d84.png"},6842:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"proxmox/networking/multi-smb-tailscale","title":"Proxmox Multi-SMB via Tailscale","description":"Contexte","source":"@site/docs/proxmox/networking/multi-smb-tailscale.md","sourceDirName":"proxmox/networking","slug":"/proxmox/networking/multi-smb-tailscale","permalink":"/multi-smb-tailscale/proxmox/networking/multi-smb-tailscale","draft":false,"unlisted":false,"editUrl":"https://github.com/GhislainSamy/multi-smb-tailscale/docs/proxmox/networking/multi-smb-tailscale.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Installation du conteneur LXC Tailscale (Contrib)","permalink":"/multi-smb-tailscale/proxmox/lxc/tailscale-installation-contrib"}}');var s=i(4848),t=i(8453);const l={},a="Proxmox Multi-SMB via Tailscale",c={},o=[{value:"Contexte",id:"contexte",level:2},{value:"Contexte technique",id:"contexte-technique",level:2},{value:"Sch\xe9ma d&#39;architecture",id:"sch\xe9ma-darchitecture",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Configuration initiale",id:"configuration-initiale",level:2},{value:"Cr\xe9er un compte chez Tailscale",id:"cr\xe9er-un-compte-chez-tailscale",level:3},{value:"Installer Tailscale LXC (Advertising)",id:"installer-tailscale-lxc-advertising",level:3},{value:"Configuration Access Control",id:"configuration-access-control",level:3},{value:"Installation Tailscale LXC (Contrib)",id:"installation-tailscale-lxc-contrib",level:2},{value:"Installation des d\xe9pendances",id:"installation-des-d\xe9pendances",level:3},{value:"Installation de rclone et fuse",id:"installation-de-rclone-et-fuse",level:3},{value:"Autoriser FUSE dans le conteneur",id:"autoriser-fuse-dans-le-conteneur",level:3},{value:"Configuration de rclone",id:"configuration-de-rclone",level:2},{value:"Configurer le partage SMB distant",id:"configurer-le-partage-smb-distant",level:3},{value:"Cr\xe9er le point de montage",id:"cr\xe9er-le-point-de-montage",level:3},{value:"Configuration du montage automatique",id:"configuration-du-montage-automatique",level:2},{value:"Service systemd pour rclone",id:"service-systemd-pour-rclone",level:3},{value:"Options de montage rclone",id:"options-de-montage-rclone",level:3},{value:"Activer le service",id:"activer-le-service",level:3},{value:"Configuration du serveur Samba",id:"configuration-du-serveur-samba",level:2},{value:"Installation de Samba",id:"installation-de-samba",level:3},{value:"Cr\xe9ation d&#39;un utilisateur Samba",id:"cr\xe9ation-dun-utilisateur-samba",level:3},{value:"Configuration du partage Samba",id:"configuration-du-partage-samba",level:3},{value:"Red\xe9marrer le service Samba",id:"red\xe9marrer-le-service-samba",level:3},{value:"Configuration c\xf4t\xe9 Proxmox",id:"configuration-c\xf4t\xe9-proxmox",level:2},{value:"Montage SMB sur l&#39;h\xf4te",id:"montage-smb-sur-lh\xf4te",level:3},{value:"Configuration fstab",id:"configuration-fstab",level:3},{value:"Test du montage",id:"test-du-montage",level:3},{value:"Configuration du conteneur Plex",id:"configuration-du-conteneur-plex",level:3},{value:"Configuration Plex",id:"configuration-plex",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"proxmox-multi-smb-via-tailscale",children:"Proxmox Multi-SMB via Tailscale"})}),"\n",(0,s.jsx)(n.h2,{id:"contexte",children:"Contexte"}),"\n",(0,s.jsx)(n.p,{children:"L'objectif est de partager le dossier des m\xe9dias via SMB en passant par le tunnel Tailscale. Ainsi, Plex peut lire les fichiers directement et proposer d'immenses biblioth\xe8ques de contenu sans duplication, ce qui permet d'\xe9conomiser beaucoup d'espace de stockage."}),"\n",(0,s.jsx)(n.admonition,{title:"Cas d'usage",type:"info",children:(0,s.jsx)(n.p,{children:"Le syst\xe8me prend tout son sens lorsque plusieurs personnes participent au partage : chacun peut contribuer avec ses propres fichiers, et l'ensemble est rendu accessible \xe0 tous de mani\xe8re transparente."})}),"\n",(0,s.jsx)(n.h2,{id:"contexte-technique",children:"Contexte technique"}),"\n",(0,s.jsxs)(n.p,{children:["Nous avons choisi d\u2019utiliser des conteneurs ",(0,s.jsx)(n.strong,{children:"LXC"}),", car ils sont extr\xeamement l\xe9gers et performants gr\xe2ce \xe0 leur proximit\xe9 avec l\u2019h\xf4te Proxmox."]}),"\n",(0,s.jsx)(n.p,{children:"Cependant, cette approche pr\xe9sente aussi des limitations :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Dans un conteneur ",(0,s.jsx)(n.strong,{children:"non privil\xe9gi\xe9"}),", il n\u2019est pas possible de monter directement un partage SMB et de remonter ensuite ce contenu sur l\u2019h\xf4te."]}),"\n",(0,s.jsx)(n.li,{children:"Cette contrainte est li\xe9e aux restrictions du kernel et \xe0 l\u2019isolation propre aux conteneurs LXC."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Pour contourner cette limite, la solution consiste \xe0 :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monter le partage SMB dans le conteneur avec Rclone"})," (qui utilise FUSE, compatible avec les LXC non privil\xe9gi\xe9s)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Exposer ce montage via un serveur Samba"})," install\xe9 dans le conteneur, afin de rendre les donn\xe9es accessibles sur le r\xe9seau local ou depuis l\u2019h\xf4te."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sch\xe9ma-darchitecture",children:"Sch\xe9ma d'architecture"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Sch\xe9ma Plex SMB",src:i(6041).A+"",width:"596",height:"362"})}),"\n",(0,s.jsx)(n.h2,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,s.jsx)(n.admonition,{title:"V\xe9rifications importantes",type:"warning",children:(0,s.jsx)(n.p,{children:"Avant de commencer, assurez-vous d'avoir :"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"1 conteneur LXC Tailscale (advertising)"})," : d\xe9di\xe9 exclusivement \xe0 la publication du subnet"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"1 conteneur LXC Tailscale (Contrib)"}),": utilis\xe9 uniquement pour se connecter au tailnet du deuxi\xe8me contributeur"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"1 conteneur LXC Plex"})," : disposera, via des points de montage depuis l'h\xf4te, d'un acc\xe8s \xe0 plusieurs partages de contributeur"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-initiale",children:"Configuration initiale"}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9er-un-compte-chez-tailscale",children:"Cr\xe9er un compte chez Tailscale"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Rendez-vous sur ",(0,s.jsx)(n.a,{href:"https://tailscale.com",children:"Tailscale"})]}),"\n",(0,s.jsx)(n.li,{children:"Cr\xe9ez votre compte"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"installer-tailscale-lxc-advertising",children:"Installer Tailscale LXC (Advertising)"}),"\n",(0,s.jsx)(n.admonition,{title:"R\xe9f\xe9rence",type:"tip",children:(0,s.jsxs)(n.p,{children:["Suivez le guide : ",(0,s.jsx)(n.a,{href:"../lxc/tailscale-installation-advertising",children:"Installer le conteneur LXC Tailscale (Advertising)"})]})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-access-control",children:"Configuration Access Control"}),"\n",(0,s.jsxs)(n.p,{children:["Allez dans Access Control puis ajouter le droit SMB :\r\n",(0,s.jsx)(n.a,{href:"https://login.tailscale.com/admin/acls/file",children:"https://login.tailscale.com/admin/acls/file"})]}),"\n",(0,s.jsx)(n.p,{children:"Choisir le format JSON, voici un exemple :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="ACL Configuration"',children:'{\r\n  "ACLs": [\r\n    {\r\n      "Action": "accept",\r\n      "Users": [\r\n        "contributeur@gmail.com"\r\n      ],\r\n      "Ports": [\r\n        "192.168.x.x:139",\r\n        "192.168.x.x:445"\r\n      ]\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Ici, nous autorisons ",(0,s.jsx)(n.code,{children:"contributeur@gmail.com"})," \xe0 acc\xe9der en SMB au serveur ",(0,s.jsx)(n.code,{children:"192.168.x.x"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"installation-tailscale-lxc-contrib",children:"Installation Tailscale LXC (Contrib)"}),"\n",(0,s.jsx)(n.admonition,{title:"R\xe9f\xe9rence",type:"tip",children:(0,s.jsxs)(n.p,{children:["Suivez le guide : ",(0,s.jsx)(n.a,{href:"../lxc/tailscale-installation-contrib",children:"Installer le conteneur LXC Tailscale (contrib)"})]})}),"\n",(0,s.jsx)(n.h1,{id:"configuration-montage-smb-de-tailscale-lxc-contrib",children:"Configuration montage SMB de Tailscale LXC (Contrib)"}),"\n",(0,s.jsx)(n.h3,{id:"installation-des-d\xe9pendances",children:"Installation des d\xe9pendances"}),"\n",(0,s.jsx)(n.p,{children:"Pour tester l'acc\xe8s au partage SMB distant :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt-get install smbclient\n"})}),"\n",(0,s.jsx)(n.p,{children:"Test de connexion :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"smbclient -L //192.168.x.x -U utilisateur\n"})}),"\n",(0,s.jsx)(n.p,{children:"Exemple :"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"alt text",src:i(9688).A+"",width:"798",height:"341"})}),"\n",(0,s.jsx)(n.h3,{id:"installation-de-rclone-et-fuse",children:"Installation de rclone et fuse"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt update && apt install -y rclone fuse\n"})}),"\n",(0,s.jsx)(n.h3,{id:"autoriser-fuse-dans-le-conteneur",children:"Autoriser FUSE dans le conteneur"}),"\n",(0,s.jsxs)(n.p,{children:["Dans la configuration LXC (",(0,s.jsx)(n.code,{children:"/etc/pve/lxc/<ID_CT>.conf"}),"), ajouter :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"features: fuse=1,nesting=1\r\nlxc.apparmor.profile: generated\r\nlxc.cgroup2.devices.allow: c 10:229 rwm\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Explication des param\xe8tres",type:"info",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fuse=1"})," : Active FUSE dans le conteneur non privil\xe9gi\xe9"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"nesting=1"})," : Permet l'ex\xe9cution de processus utilisant FUSE"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"c 10:229 rwm"})," : Donne acc\xe8s au p\xe9riph\xe9rique ",(0,s.jsx)(n.code,{children:"/dev/fuse"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"lxc.apparmor.profile: generated"})," : Utilise le profil AppArmor g\xe9n\xe9r\xe9 par Proxmox"]}),"\n"]})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Red\xe9marrer le conteneur"})," apr\xe8s cette modification."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-de-rclone",children:"Configuration de rclone"}),"\n",(0,s.jsx)(n.h3,{id:"configurer-le-partage-smb-distant",children:"Configurer le partage SMB distant"}),"\n",(0,s.jsx)(n.p,{children:"Lancer la configuration interactive :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"rclone config\n"})}),"\n",(0,s.jsx)(n.p,{children:"Configuration \xe9tape par \xe9tape :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"n"})," \u2192 cr\xe9er une nouvelle remote"]}),"\n",(0,s.jsxs)(n.li,{children:["Nom : ",(0,s.jsx)(n.code,{children:"contrib"})]}),"\n",(0,s.jsxs)(n.li,{children:["Type : ",(0,s.jsx)(n.code,{children:"smb"})]}),"\n",(0,s.jsxs)(n.li,{children:["Serveur : ",(0,s.jsx)(n.code,{children:"192.168.x.x"})]}),"\n",(0,s.jsxs)(n.li,{children:["User : ",(0,s.jsx)(n.code,{children:"nom_utilisateur"})]}),"\n",(0,s.jsxs)(n.li,{children:["Password : ",(0,s.jsx)(n.code,{children:"mot_de_passe"})]}),"\n",(0,s.jsx)(n.li,{children:"Domaine : laisser vide ou saisir si n\xe9cessaire"}),"\n",(0,s.jsx)(n.li,{children:"q pour quiter \xe0 partir des choix propos\xe9"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9er-le-point-de-montage",children:"Cr\xe9er le point de montage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir /mnt/rclone_mount\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-du-montage-automatique",children:"Configuration du montage automatique"}),"\n",(0,s.jsx)(n.h3,{id:"service-systemd-pour-rclone",children:"Service systemd pour rclone"}),"\n",(0,s.jsx)(n.p,{children:"Cr\xe9er le fichier de service :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /etc/systemd/system/rclone-contrib.service\n"})}),"\n",(0,s.jsx)(n.p,{children:"Contenu du service :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",metastring:'title="/etc/systemd/system/rclone-contrib.service"',children:"[Unit]\r\nDescription=Mount SMB via rclone\r\nAfter=network-online.target\r\nWants=network-online.target\r\n\r\n[Service]\r\nType=simple\r\nExecStart=/usr/bin/rclone mount contrib:video /mnt/rclone_mount \\\r\n    --vfs-cache-mode full \\\r\n    --vfs-cache-max-size 10G \\\r\n    --vfs-cache-poll-interval 5m \\\r\n    --allow-other \\\r\n    --uid 1000 --gid 1000 \\\r\n    --umask 002 \\\r\n    --vfs-read-chunk-size 128M \\\r\n    --vfs-read-chunk-size-limit 2G\r\nRestart=on-failure\r\nUser=root\r\nGroup=root\r\n\r\n[Install]\r\nWantedBy=multi-user.target\n"})}),"\n",(0,s.jsx)(n.h3,{id:"options-de-montage-rclone",children:"Options de montage rclone"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--vfs-cache-mode full"})}),(0,s.jsx)(n.td,{children:"Cache complet pour lecture/\xe9criture, compatible applications"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--vfs-cache-max-size 10G"})}),(0,s.jsx)(n.td,{children:"Limite la taille du cache \xe0 10GB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--vfs-cache-poll-interval 5m"})}),(0,s.jsx)(n.td,{children:"Actualise le cache toutes les 5 minutes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--allow-other"})}),(0,s.jsx)(n.td,{children:"Permet \xe0 d'autres utilisateurs du conteneur d'acc\xe9der au montage"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--uid 1000 --gid 1000"})}),(0,s.jsx)(n.td,{children:"Attribue le propri\xe9taire aux fichiers du montage"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--umask 002"})}),(0,s.jsx)(n.td,{children:"Permissions pour groupe/autres"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--vfs-read-chunk-size 128M"})}),(0,s.jsx)(n.td,{children:"Taille des chunks de lecture pour optimisation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--vfs-read-chunk-size-limit 2G"})}),(0,s.jsx)(n.td,{children:"Limite maximale des chunks pour streaming de gros fichiers"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"activer-le-service",children:"Activer le service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl daemon-reload\r\nsystemctl enable rclone-contrib\r\nsystemctl start rclone-contrib\n"})}),"\n",(0,s.jsx)(n.p,{children:"V\xe9rifier le statut :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status rclone-contrib\n"})}),"\n",(0,s.jsx)(n.p,{children:"V\xe9rifier si tout est bien mont\xe9 :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ls /mnt/rclone_mount\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-du-serveur-samba",children:"Configuration du serveur Samba"}),"\n",(0,s.jsx)(n.h3,{id:"installation-de-samba",children:"Installation de Samba"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt update && apt install -y samba\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-dun-utilisateur-samba",children:"Cr\xe9ation d'un utilisateur Samba"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er un utilisateur Linux minimal\r\nuseradd -M -s /usr/sbin/nologin contrib\r\n\r\n# Ajouter l'utilisateur \xe0 Samba\r\nsmbpasswd -a contrib\r\n# Saisir un mot de passe Samba s\xe9curis\xe9\r\n\r\n# Activer l'utilisateur\r\nsmbpasswd -e contrib\r\n\r\n# V\xe9rifier la cr\xe9ation\r\npdbedit -L\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-du-partage-samba",children:"Configuration du partage Samba"}),"\n",(0,s.jsxs)(n.p,{children:["Modifier ",(0,s.jsx)(n.code,{children:"/etc/samba/smb.conf"})," et ajouter :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",metastring:'title="/etc/samba/smb.conf"',children:"[ContribSMB]\r\n   path = /mnt/rclone_mount\r\n   browseable = yes\r\n   read only = yes\r\n   guest ok = no\r\n   valid users = contrib\r\n   force user = contrib\r\n   force group = contrib\r\n   create mask = 0664\r\n   directory mask = 0775\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"S\xe9curit\xe9",type:"warning",children:(0,s.jsxs)(n.p,{children:["Cette configuration limite l'acc\xe8s au seul utilisateur ",(0,s.jsx)(n.code,{children:"contrib"})," et applique des permissions appropri\xe9es."]})}),"\n",(0,s.jsx)(n.h3,{id:"red\xe9marrer-le-service-samba",children:"Red\xe9marrer le service Samba"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl restart smbd\r\nsystemctl enable smbd\n"})}),"\n",(0,s.jsx)(n.p,{children:"V\xe9rifier le statut :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status smbd\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-c\xf4t\xe9-proxmox",children:"Configuration c\xf4t\xe9 Proxmox"}),"\n",(0,s.jsx)(n.h3,{id:"montage-smb-sur-lh\xf4te",children:"Montage SMB sur l'h\xf4te"}),"\n",(0,s.jsx)(n.p,{children:"Cr\xe9er le r\xe9pertoire de montage :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir /mnt/smb_contributeur\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cr\xe9er le fichier de credentials :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"vi /root/.smbcredentialscontrib\n"})}),"\n",(0,s.jsx)(n.p,{children:"Contenu :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",metastring:'title="/root/.smbcredentialscontrib"',children:"username=contrib\r\npassword=mot_de_passe_samba\n"})}),"\n",(0,s.jsx)(n.p,{children:"S\xe9curiser le fichier :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod 600 /root/.smbcredentialscontrib\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-fstab",children:"Configuration fstab"}),"\n",(0,s.jsxs)(n.p,{children:["Ajouter dans ",(0,s.jsx)(n.code,{children:"/etc/fstab"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="/etc/fstab"',children:"//IP_CONTENEUR_LXC_TAILSCALE/ContribSMB /mnt/smb_contributeur cifs credentials=/root/.smbcredentialscontrib,uid=100000,gid=100000,_netdev,iocharset=utf8,vers=3.0 0 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"test-du-montage",children:"Test du montage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mount -a\r\ncd /mnt/smb_contributeur\r\nls\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-du-conteneur-plex",children:"Configuration du conteneur Plex"}),"\n",(0,s.jsxs)(n.p,{children:["Ajouter le mount point dans ",(0,s.jsx)(n.code,{children:"/etc/pve/lxc/<ID_CT>.conf.conf"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"mp1: /mnt/smb_contributeur,mp=/mnt/smb_contributeur\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Num\xe9rotation des mount points",type:"info",children:(0,s.jsx)(n.p,{children:"Les mount points sont num\xe9rot\xe9s s\xe9quentiellement : mp0, mp1, mp2, etc. selon l'ordre d'ajout dans la configuration du conteneur. Vu qu'il y a mon Nas en mp0 c'est pour cela que j'ai mis mp1 ici."})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-plex",children:"Configuration Plex"}),"\n",(0,s.jsxs)(n.p,{children:["Une fois le montage fonctionnel, ajouter le chemin ",(0,s.jsx)(n.code,{children:"/mnt/smb_contributeur"})," dans la configuration des biblioth\xe8ques Plex."]}),"\n",(0,s.jsx)(n.p,{children:"Exemple :"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Exemple de montage de dossier plex",src:i(7513).A+"",width:"571",height:"250"})}),"\n",(0,s.jsx)(n.admonition,{title:"Installation termin\xe9e",type:"success",children:(0,s.jsx)(n.p,{children:"Le serveur SMB interne avec rclone est maintenant configur\xe9 et op\xe9rationnel. Le contenu du partage distant sera accessible via Samba et mont\xe9 automatiquement dans Plex."})}),"\n",(0,s.jsx)(n.admonition,{title:"Aide",type:"tip",children:(0,s.jsxs)(n.p,{children:["Pour toute question, ouvrez une issue sur ",(0,s.jsx)(n.a,{href:"https://github.com/GhislainSamy/multi-smb-tailscale/issues",children:"GitHub"}),"."]})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},7513:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/exemple_plex_dossier_montage-2561411f5360800017a0fe39164a7000.png"},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}},9688:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/exemple_test_smbclient-e5e78a973badc771553d3b316276cc94.png"}}]);